import{a as A}from"./chunk-GEBP7ZCE.js";import{a as D}from"./chunk-PTJDRHHQ.js";import{a as v}from"./chunk-BZ2FDTJU.js";import{$ as E,A as n,B as a,C as p,F as x,G as h,H as d,K as u,M as U,Q as C,Y as O,_ as j,c as y,f as S,ga as k,h as R,i as _,j as g,ka as T,l,la as L,m as H,ma as N,p as w,q as P,s as I,t as c,u as s,v as f,x as m}from"./chunk-EPVYEA6G.js";function $(r,t){if(r&1&&p(0,"img",14),r&2){let e=d(2);m("src",e.profilePicturePath,I)}}function z(r,t){if(r&1){let e=x();n(0,"li")(1,"a",12),h("click",function(){w(e);let o=d(2);return P(o.changeProfilePicture())}),p(2,"i",15),u(3,"Change Profile Picture "),a()()}}function q(r,t){if(r&1){let e=x();n(0,"div",5)(1,"ul",6)(2,"li",7)(3,"a",8),f(4,$,1,1,"img",9),u(5),a(),n(6,"ul",10),f(7,z,4,0,"li",11),n(8,"li")(9,"a",12),h("click",function(){w(e);let o=d();return P(o.logout())}),p(10,"i",13),u(11,"Logout "),a()()()()()()}if(r&2){let e=d();c(4),m("ngIf",e.roles.includes("HomeOwner")),c(),U(" ",e.userEmail," "),c(2),m("ngIf",e.roles.includes("HomeOwner"))}}var F=class r{constructor(t,e,i,o,G){this.authService=t;this.router=e;this.userService=i;this.sharedService=o;this.loadingService=G}userEmail=null;profilePicturePath="";roles=[];dataLoaded=!1;ngOnInit(){this.loadUserData(),this.sharedService.profilePictureUpdated$.subscribe(()=>{this.loadUserData()}),this.sharedService.roleUpdated$.subscribe(()=>{this.loadUserData()})}loadUserData(){return y(this,null,function*(){try{this.userEmail=yield this.getEmail(),this.userEmail&&(this.profilePicturePath=yield this.getProfilePath(this.userEmail)),this.roles=yield this.getRoles(),this.dataLoaded=!0}catch(t){console.error("Error loading user data:",t)}})}getEmail(){return new Promise((t,e)=>{let i=this.authService.getEmail();i?t(i):e("No email found")})}getProfilePath(t){return new Promise((e,i)=>{this.loadingService.show(),this.userService.getProfilePicture(t).subscribe({next:o=>{this.loadingService.hide(),e(o.data)},error:o=>{i(o)}})})}getRoles(){return new Promise((t,e)=>{let i=this.authService.getRoles();i?t(i):e("No roles found")})}changeProfilePicture(){this.router.navigate(["/update-profile-picture"])}logout(){this.authService.logout(),this.router.navigate(["/login"])}goToMainPage=()=>{this.router.navigate(["/"])};static \u0275fac=function(e){return new(e||r)(s(v),s(k),s(D),s(A),s(N))};static \u0275cmp=H({type:r,selectors:[["app-header"]],standalone:!0,features:[C],decls:6,vars:1,consts:[[1,"navbar","navbar-expand-lg","navbar-light","bg-light","sticky-top"],[1,"container"],["role","button",1,"navbar-brand",2,"cursor","pointer",3,"click"],["src","logo.png","alt","Logo","width","40","height","40",1,"d-inline-block","align-top"],["class","collapse navbar-collapse",4,"ngIf"],[1,"collapse","navbar-collapse"],[1,"navbar-nav","ms-auto"],[1,"nav-item","dropdown"],["href","#","id","userDropdown","role","button","data-bs-toggle","dropdown","aria-expanded","false",1,"nav-link","dropdown-toggle","font-weight-bold"],["alt","User Photo","width","30","height","30","class","rounded-circle me-2 border border-success",3,"src",4,"ngIf"],["aria-labelledby","userDropdown",1,"dropdown-menu","dropdown-menu-end","shadow-lg"],[4,"ngIf"],["role","button",1,"dropdown-item","py-2",3,"click"],[1,"bi","bi-box-arrow-right","me-2"],["alt","User Photo","width","30","height","30",1,"rounded-circle","me-2","border","border-success",3,"src"],[1,"bi","bi-camera","me-2"]],template:function(e,i){e&1&&(n(0,"nav",0)(1,"div",1)(2,"a",2),h("click",function(){return i.goToMainPage()}),p(3,"img",3),u(4," Smarthome "),a(),f(5,q,12,3,"div",4),a()()),e&2&&(c(5),m("ngIf",i.dataLoaded))},dependencies:[j,O],encapsulation:2})};var b=class r extends L{constructor(e){super(T.apiUrl,"me/roles",e);this.http=e}getRoles(){return this.get()}addRole(e){return this.post(e)}static \u0275fac=function(i){return new(i||r)(l(E))};static \u0275prov=g({token:r,factory:r.\u0275fac,providedIn:"root"})};var M=class r{constructor(t,e){this.userRoleRepostory=t;this.authService=e}UserRoles=[];getToken(){return this.authService.getToken()}getRolesFromLocalStorage(){let t=localStorage.getItem("userRoles");return t?JSON.parse(t):[]}getUserRoles(){return this.UserRoles||this.getRolesFromLocalStorage()}addUserRole(t){return this.userRoleRepostory.addRole({Role:t}).pipe(R(e=>(e.status===0&&console.error("No se pudo establecer la conexi\xF3n con el servidor"),S(e)))).pipe(_(e=>{this.UserRoles.push(t),localStorage.setItem("userRoles",JSON.stringify(this.UserRoles))}))}loadUserRoles(){return this.userRoleRepostory.getRoles().pipe(R(t=>(t.status===0&&console.error("No se pudo establecer la conexi\xF3n con el servidor"),S(t)))).pipe(_(t=>{this.UserRoles=t.data.roles,localStorage.setItem("userRoles",JSON.stringify(this.UserRoles))}))}static \u0275fac=function(e){return new(e||r)(l(b),l(v))};static \u0275prov=g({token:r,factory:r.\u0275fac,providedIn:"root"})};export{M as a,F as b};
